---
title: "Einsum Tutorial"
date: 2025-11-12
categories: [tutorial, python, study]
description: "Brief introduction to Einsum"
---

# Introduction

Einstein summation notation, commonly denoted as `einsum`,
is a powerful tool for performing optimized matrix operations. It allows
us to avoid using unnecessary for loops and simplifies complex matrix
manipulations, making code more readable and efficient.

Einsum is available in different libraries such as [Numpy](https://numpy.org/doc/stable/reference/generated/numpy.einsum.html),
[PyTorch](https://pytorch.org/docs/stable/generated/torch.einsum.html) and [Tensorflow](https://www.tensorflow.org/api_docs/python/tf/einsum).

# What is `einsum`?

## Matrix notation

Before diving deeper into `einsum`, let us briefly review some matrix terminology. Consider a matrix $A$ with three rows and three columns:

$$
A = \begin{bmatrix}
a_{11} & a_{12} & a_{13} \\
a_{21} & a_{22} & a_{23} \\
a_{31} & a_{32} & a_{33}
\end{bmatrix}
$$

This matrix is described as a $3 \times 3$ matrix.

The element in the first row and first column is $a_{11}$ and the element in the second row and third column is $a_{23}$. In general, the element in the $i$th row and $j$th column is $a_{ij}$.

This notation also applies to tensors. For a one dimensional vector $v$, the $i$th element is denoted by $v_i$.

## Intuition

The `einsum` operation performs two fundamental actions over tensors: **multiplication** and **summation**.

We now explore the logic behind both.

### Multiplication

Let $A$ and $B$ be two $3 \times 3$ matrices. We create another matrix $C$ whose elements are obtained from elementwise multiplication:

$$
c_{ij} = a_{ij} b_{ij}
$$

Python:

```python
import numpy as np
A = np.random.random((3, 3))
B = np.random.random((3, 3))
C = np.multiply(A, B)
```

Using einsum:

```python
C = np.einsum("ij,ij->ij", A, B)
```

This mirrors the mathematical expression $c_{ij} = a_{ij} b_{ij}$.

We can also express it as a loop:

```python
C = np.zeros((3, 3))
for i in range(3):
    for j in range(3):
        C[i, j] = A[i, j] * B[i, j]
```

Let us now work with vectors. For $v = [1, 2, 3]$ and $p = [4, 5, 6]$:

$$
z_i = v_i p_i
$$

Using einsum:

```python
z = np.einsum("i,i->i", v, p)
```

Using loops:

```python
z = np.zeros(3)
for i in range(3):
    z[i] = v[i] * p[i]
```

Now consider using different indices, `"i,j"`:

```python
np.einsum("i,j->ij", v, p)
```

This produces all combinations $v_i p_j$ and forms a $3 \times 3$ matrix. Loop equivalent:

```python
for i in range(3):
    for j in range(3):
        C[i, j] = v[i] * p[j]
```

### Summation

`einsum` also performs summation over indices. If an index appears in the input but not in the output, the summation is applied over that index.

To sum all elements of a vector $a$:

Math notation:

$$
c = \sum_i a_i
$$

Einsum:

```python
c = np.einsum("i->", a)
```

To sum all elements of a matrix $A$:

```python
s = np.einsum("ij->", A)
```

### Matrix multiplication

Let $A$ be a $2 \times 3$ matrix and $B$ a $3 \times 2$ matrix. Their product $C = AB$ has components:

$$
c_{ik} = \sum_j a_{ij} b_{jk}
$$

Einsum:

```python
C = np.einsum("ij,jk->ik", A, B)
```

## Practice

### 1. Transpose a matrix

The transpose of $A = [a_{ij}]$ is $A^{\mathsf{T}} = [a_{ji}]$.

Using einsum:

```python
C = np.einsum("ij->ji", A)
```

### 2. Compute the trace of a square matrix

For a square matrix:

$$
A = \begin{bmatrix}
a_{11} & a_{12} \\
a_{21} & a_{22}
\end{bmatrix}
$$

The trace is:

$$
\operatorname{Tr}(A) = \sum_i a_{ii}
$$

Using einsum:

```python
tr = np.einsum("ii->", A)
```

### 3. Compute the Euclidean norm of a vector

$$
\|v\| = \sqrt{\sum_i v_i v_i}
$$

Using einsum:

```python
norm = np.sqrt(np.einsum("i,i->", v, v))
```

### 4. Batch matrix multiplication

Let $A$ be a batch of matrices with shape $(n, p, h)$ and $B$ be a batch of matrices with shape $(n, h, u)$.

The batch product is:

$$
c_{nik} = \sum_j a_{nij} b_{njk}
$$

Using einsum:

```python
C = np.einsum("nij,njk->nik", A, B)
```
